<p-toast></p-toast>

<div class="card">
  <div class="flex align-items-center gap-2 mb-4">
    <i class="pi pi-list text-primary text-2xl"></i>
    <h2 class="m-0 text-primary">Histórico de Itinerários</h2>
  </div>

  <p-table [value]="itinerarios" [paginator]="true" [rows]="10" [loading]="carregando" responsiveLayout="scroll" styleClass="p-datatable-striped">
    <ng-template pTemplate="header">
      <tr>
        <th pSortableColumn="id" style="width: 80px;">ID <p-sortIcon field="id"></p-sortIcon></th>
        <th pSortableColumn="dataAgendamento">Data <p-sortIcon field="dataAgendamento"></p-sortIcon></th>
        <th pSortableColumn="caminhao.placa">Veículo <p-sortIcon field="caminhao.placa"></p-sortIcon></th>
        <th pSortableColumn="distanciaTotal">Distância (Km) <p-sortIcon field="distanciaTotal"></p-sortIcon></th>
        <th>Percurso (Bairros)</th>
        <th pSortableColumn="status">Status <p-sortIcon field="status"></p-sortIcon></th>
      </tr>
    </ng-template>
    
    <ng-template pTemplate="body" let-itinerario>
      <tr>
        <td class="text-500">{{ itinerario.id }}</td>
        <td>{{ itinerario.data | date:'dd/MM/yyyy' }}</td> 
        <td><span class="font-bold">{{ itinerario.caminhaoPlaca }}</span> ({{ itinerario.caminhaoMotorista }})</td>
        <td>{{ itinerario.distanciaTotal | number:'1.0-2' }}</td>
        <td>
            <span class="text-500" pTooltip="{{ formatarBairros(itinerario) }}" tooltipPosition="top">
                {{ itinerario.sequenciaBairros?.[0]?.nome || 'N/A' }} → ... → {{ itinerario.sequenciaBairros?.[itinerario.sequenciaBairros.length - 1]?.nome || 'N/A' }}
            </span>
        </td>
        <td>
          <p-tag [value]="itinerario.status" [severity]="getSeverity(itinerario.status)"></p-tag>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="text-center p-4">
          <span class="text-500">Nenhum itinerário encontrado.</span>
        </td>
      </tr>
    </ng-template>
  </p-table>

  <div class="text-sm text-500 mt-2">
    Total de registros: {{ itinerarios.length }}
  </div>
</div>